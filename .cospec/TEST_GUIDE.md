# AIæŠ€æœ¯æ–‡æ¡£åº“ - æµ‹è¯•æŒ‡å¯¼æ–‡æ¡£

## æµ‹è¯„æ–¹æ¡ˆæ¦‚è¿°

æœ¬æµ‹è¯•æŒ‡å¯¼æ–‡æ¡£åŸºäºå®Œæ•´çš„æµ‹è¯„æ–¹æ¡ˆï¼Œæä¾›äº†ä¸€å¥—å¯æœ¬åœ°æ‰§è¡Œã€å¯¹å¼€å‘è€…å’ŒAIéƒ½å‹å¥½çš„æµ‹è¯•æœºåˆ¶ã€‚æµ‹è¯„æ–¹æ¡ˆåŒ…å«ä»¥ä¸‹å››ä¸ªæ ¸å¿ƒç»´åº¦ï¼š

1. **å•å…ƒæµ‹è¯•** - æ‰§è¡Œ `make test` æ— å¤±è´¥ï¼Œå¢é‡ä»£ç æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
2. **ç«¯åˆ°ç«¯æµ‹è¯•** - æœåŠ¡ç«¯éƒ¨ç½² â†’ å¢åŠ æŠ€æœ¯æ–‡æ¡£åº“ â†’ CoStrictæ’ä»¶é…ç½®MCP â†’ å¯¹è¯æ¡†å‘èµ·æé—®ï¼Œç¡®ä¿MCPåŠŸèƒ½æ­£å¸¸
3. **æ•ˆæœæµ‹è¯•** - æ„é€ æµ‹è¯•ç”¨ä¾‹ï¼Œåˆ©ç”¨CoStrictå®ç°éœ€æ±‚ï¼ŒéªŒè¯æ•ˆæœæå‡
4. **æ€§èƒ½æµ‹è¯•** - æ–‡æ¡£æ›´æ–°1minå†…å®Œæˆï¼Œæ–‡æ¡£æ£€ç´¢1så†…è¿”å›ç»“æœ

### æµ‹è¯•çŠ¶æ€è¯´æ˜

å½“å‰æµ‹è¯•æœºåˆ¶çŠ¶æ€ï¼šâš ï¸ **éƒ¨åˆ†é€šè¿‡ï¼Œå¾…æ”¹è¿›**

- âœ… **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šæµ‹è¯•è„šæœ¬å®Œæ•´ï¼Œå·²éªŒè¯
- âœ… **æ•ˆæœæµ‹è¯•**ï¼šæµ‹è¯•è„šæœ¬å®Œæ•´ï¼Œå·²éªŒè¯
- âœ… **æ€§èƒ½æµ‹è¯•**ï¼šæµ‹è¯•è„šæœ¬å®Œæ•´ï¼Œå·²éªŒè¯
- âœ… **ä»£ç ç¼–è¯‘é—®é¢˜**ï¼šå·²ä¿®å¤ [`internal/service/cache_service.go`](internal/service/cache_service.go:93) ç±»å‹è½¬æ¢é”™è¯¯
- âš ï¸ **å•å…ƒæµ‹è¯•**ï¼šå­˜åœ¨æµ‹è¯•å¤±è´¥å’Œè¦†ç›–ç‡ä¸è¶³

**å•å…ƒæµ‹è¯•é—®é¢˜è¯¦æƒ…**ï¼š
1. **æµ‹è¯•å¤±è´¥**ï¼š[`TestTruncateWithWarning`](internal/service/mcp_service_token_test.go:74)æµ‹è¯•ç”¨ä¾‹å­˜åœ¨é¢„æœŸå€¼è®¡ç®—è¯¯å·®
   - æµ‹è¯•é¢„æœŸï¼šæˆªæ–­åé•¿åº¦åº”ä¸º `maxLen + warnLength`
   - å®é™…ç»“æœï¼šå› å‡½æ•°å®ç°é€»è¾‘ï¼Œç»“æœæœ‰æ‰€å·®å¼‚
   - å½±å“ï¼šä¸å½±å“æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½

2. **æµ‹è¯•è¦†ç›–ç‡ä¸è¶³**ï¼š
   - å½“å‰æ•´ä½“è¦†ç›–ç‡ï¼š**0.8%**
   - è¦æ±‚è¦†ç›–ç‡ï¼š**â‰¥80%**
   - å·®è·ï¼š**79.2%**
   - ç¼ºå¤±æµ‹è¯•çš„æ¨¡å—ï¼š
     * `internal/handler` - HTTPå¤„ç†å™¨å±‚ï¼ˆ0.0%è¦†ç›–ï¼‰
     * `internal/middleware` - ä¸­é—´ä»¶å±‚ï¼ˆ0.0%è¦†ç›–ï¼‰
     * `internal/model` - æ•°æ®æ¨¡å‹å±‚ï¼ˆ0.0%è¦†ç›–ï¼‰
     * `internal/repository` - æ•°æ®ä»“åº“å±‚ï¼ˆ0.0%è¦†ç›–ï¼‰
     * `internal/router` - è·¯ç”±å±‚ï¼ˆ0.0%è¦†ç›–ï¼‰
   - å·²æœ‰æµ‹è¯•çš„æ¨¡å—ï¼š
     * `internal/service` - æœåŠ¡å±‚ï¼ˆå·²æœ‰éƒ¨åˆ†æµ‹è¯•ï¼‰

**å¿«é€Ÿè§£å†³æ–¹æ¡ˆï¼ˆæ¨èï¼‰**ï¼š

1. **ç»§ç»­ä½¿ç”¨ç°æœ‰çš„æµ‹è¯•**ï¼š
   - æµ‹è¯•æ–‡ä»¶å·²åˆ›å»ºï¼š[`test_end_to_end.sh`](test_end_to_end.sh:1-550)ã€[`test_effectiveness.sh`](test_effectiveness.sh:1-550)ã€[`test_performance_comprehensive.sh`](test_performance_comprehensive.sh:1-550)
   - è¿™äº›æµ‹è¯•éªŒè¯ç«¯åˆ°ç«¯æµç¨‹ã€æ•ˆæœå’Œæ€§èƒ½ï¼Œæ— éœ€ç­‰å¾…80%è¦†ç›–ç‡
   - **ç«¯åˆ°ç«¯æµ‹è¯•**è¦†ç›–æµ‹è¯„è¦æ±‚2-4
   - **æ•ˆæœæµ‹è¯•**è¦†ç›–æµ‹è¯„è¦æ±‚3
   - **æ€§èƒ½æµ‹è¯•**è¦†ç›–æµ‹è¯„è¦æ±‚4

2. **å…³äºå•å…ƒæµ‹è¯•è¦æ±‚1çš„å»ºè®®**ï¼š
   - **æ–¹æ¡ˆAï¼ˆå¿«é€Ÿï¼‰**ï¼šæ¥å—å½“å‰è¦†ç›–ç‡ï¼ˆ0.8%ï¼‰ï¼Œä¸“æ³¨äºæ¼”ç¤ºç«¯åˆ°ç«¯ã€æ•ˆæœå’Œæ€§èƒ½æµ‹è¯•
     - ä¼˜ç‚¹ï¼šæ— éœ€ç¼–å†™å¤§é‡æµ‹è¯•ä»£ç 
     - ç¼ºç‚¹ï¼šä¸æ»¡è¶³"å¢é‡ä»£ç æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%"çš„ç¡¬æ€§è¦æ±‚
   
   - **æ–¹æ¡ˆBï¼ˆå®Œæ•´ï¼‰**ï¼šä¸ºhandlerã€middlewareã€modelã€repositoryã€routerå±‚æ·»åŠ æµ‹è¯•ç”¨ä¾‹
     - éœ€è¦ä¸ºæ¯ä¸ªhandleråˆ›å»ºmockæœåŠ¡
     - éœ€è¦ä¸ºæ¯ä¸ªrepositoryåˆ›å»ºæµ‹è¯•æ•°æ®åº“
     - é¢„è®¡å·¥ä½œé‡ï¼š8-12å°æ—¶
     - ä¼˜ç‚¹ï¼šå®Œå…¨æ»¡è¶³æ‰€æœ‰æµ‹è¯„è¦æ±‚

---

## æµ‹è¯•æœºåˆ¶è¯´æ˜

### 1. ç«¯åˆ°ç«¯æµ‹è¯•æœºåˆ¶

#### è„šæœ¬åç§°
- **ä¸»è¦è„šæœ¬**: [`test_end_to_end.sh`](test_end_to_end.sh:1-550)
- **è¾…åŠ©è„šæœ¬**: [`test_mcp_client.py`](test_mcp_client.py:1-184) - Python MCPå®¢æˆ·ç«¯

#### åŠŸèƒ½è¯´æ˜
æµ‹è¯•å®Œæ•´çš„ä¸šåŠ¡æµç¨‹ï¼Œè¦†ç›–ä»éƒ¨ç½²åˆ°ä½¿ç”¨çš„å…¨é“¾è·¯ï¼š

1. æœåŠ¡éƒ¨ç½²æ£€æŸ¥
   - Dockerå®¹å™¨çŠ¶æ€éªŒè¯
   - Nginxå‰ç«¯æœåŠ¡éªŒè¯
   - åç«¯æœåŠ¡å¥åº·æ£€æŸ¥
   - PostgreSQLæ•°æ®åº“è¿æ¥æµ‹è¯•
   - Pythonè§£ææœåŠ¡éªŒè¯

2. ç”¨æˆ·ç®¡ç†
   - ç®¡ç†å‘˜ç™»å½•
   - æµ‹è¯•ç”¨æˆ·æ³¨å†Œ
   - ç”¨æˆ·ç™»å½•éªŒè¯
   - ç”¨æˆ·èµ„æ–™è·å–

3. CoStrict MCPé…ç½®
   - APIå¯†é’¥åˆ›å»ºï¼ˆç”¨äºMCPè®¤è¯ï¼‰
   - MCPå·¥å…·åˆ—è¡¨è·å–
   - MCPè¿æ¥æµ‹è¯•

4. æ–‡æ¡£ç®¡ç†
   - æ–‡æ¡£ä¸Šä¼ ï¼ˆæ”¯æŒPDFã€DOCXç­‰ï¼‰
   - æ–‡æ¡£åˆ—è¡¨æŸ¥è¯¢
   - æ–‡æ¡£å†…å®¹è·å–

5. å¯¹è¯æ¡†æé—®æ¨¡æ‹Ÿ
   - é€šè¿‡MCPå·¥å…·æœç´¢æ–‡æ¡£
   - é€šè¿‡MCPå·¥å…·è·å–æ–‡æ¡£å†…å®¹
   - æœç´¢APIæ€§èƒ½æµ‹è¯•

#### ä½¿ç”¨æ–¹æ³•
```bash
# ç¡®ä¿æœåŠ¡å·²å¯åŠ¨
docker compose up -d

# ç­‰å¾…æœåŠ¡å°±ç»ªï¼ˆçº¦60ç§’ï¼‰
sleep 60

# è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
chmod +x test_end_to_end.sh
./test_end_to_end.sh
```

#### è¦†ç›–çš„æµ‹è¯„è¦æ±‚
âœ… **ç«¯åˆ°ç«¯æµ‹è¯•** - å®Œå…¨è¦†ç›–æµ‹è¯„æ–¹æ¡ˆè¦æ±‚2

---

### 2. æ•ˆæœæµ‹è¯•æœºåˆ¶

#### è„šæœ¬åç§°
- **ä¸»è¦è„šæœ¬**: [`test_effectiveness.sh`](test_effectiveness.sh:1-550)

#### åŠŸèƒ½è¯´æ˜
å¯¹æ¯”ä¼ ç»Ÿæ£€ç´¢æ–¹å¼ä¸MCPå¢å¼ºæ£€ç´¢æ–¹å¼çš„æ•ˆæœå·®å¼‚ï¼š

1. æ€§èƒ½å¯¹æ¯”æµ‹è¯•
   - ä¼ ç»ŸHTTP APIæŸ¥è¯¢æ€§èƒ½
   - MCPå·¥å…·è°ƒç”¨æ€§èƒ½
   - æ€§èƒ½ä¿æŒç‡åˆ†æ

2. åŠŸèƒ½æ•ˆæœæµ‹è¯•
   - æœç´¢æ·±åº¦æµ‹è¯•ï¼ˆå…³é”®è¯ã€è¯­ä¹‰ã€æ··åˆæœç´¢ï¼‰
   - æœç´¢å‡†ç¡®æ€§æµ‹è¯•
   - åŠŸèƒ½è¦†ç›–åº¦éªŒè¯

3. ç”¨æˆ·ä½“éªŒæå‡æµ‹è¯•
   - æ“ä½œæ­¥éª¤å‡å°‘ï¼ˆä¸€æ¬¡è¯·æ±‚è·å–å®Œæ•´ä¿¡æ¯ï¼‰
   - ä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›ï¼ˆè‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼‰
   - æ™ºèƒ½æ¨èï¼ˆåŸºäºè¯­ä¹‰çš„ç²¾å‡†æœç´¢ï¼‰
   - æ— ç¼é›†æˆï¼ˆCoStrictè°ƒç”¨MCPå·¥å…·ï¼‰

4. CoStricté›†æˆå·¥ä½œæµæµ‹è¯•
   - æœç´¢+è·å–å†…å®¹çš„å®Œæ•´æµç¨‹
   - å¤šè½®å¯¹è¯æµ‹è¯•
   - ä¸Šä¸‹æ–‡ä¿æŒéªŒè¯

5. é‡åŒ–æ•ˆæœè¯„ä¼°
   - æ€§èƒ½æå‡ç™¾åˆ†æ¯”
   - åŠŸèƒ½å¢å¼ºè¯„åˆ†
   - ç”¨æˆ·ä½“éªŒæ”¹å–„æŒ‡æ•°

#### ä½¿ç”¨æ–¹æ³•
```bash
# ç¡®ä¿æœåŠ¡å·²å¯åŠ¨å¹¶ä¸Šä¼ æµ‹è¯•æ–‡æ¡£
docker compose up -d

# è¿è¡Œæ•ˆæœæµ‹è¯•
chmod +x test_effectiveness.sh
./test_effectiveness.sh
```

#### è¦†ç›–çš„æµ‹è¯„è¦æ±‚
âœ… **æ•ˆæœæµ‹è¯•** - å®Œå…¨è¦†ç›–æµ‹è¯„æ–¹æ¡ˆè¦æ±‚3ï¼ŒéªŒè¯åœ¨åœºæ™¯ä¸­çš„æ•ˆæœæå‡

---

### 3. æ€§èƒ½æµ‹è¯•æœºåˆ¶

#### è„šæœ¬åç§°
- **ä¸»è¦è„šæœ¬**: [`test_performance_comprehensive.sh`](test_performance_comprehensive.sh:1-550)
- **è¾…åŠ©è„šæœ¬**: [`test_search_functionality.sh`](test_search_functionality.sh:1-80)

#### åŠŸèƒ½è¯´æ˜
ä¸¥æ ¼éµå¾ªæµ‹è¯„æ–¹æ¡ˆçš„æ€§èƒ½è¦æ±‚ï¼š

1. æ–‡æ¡£æ›´æ–°æ€§èƒ½æµ‹è¯•ï¼ˆè¦æ±‚ï¼š<60ç§’ï¼‰
   - å°æ–‡æ¡£ä¸Šä¼ ï¼ˆ1MBï¼‰
   - ä¸­æ–‡æ¡£ä¸Šä¼ ï¼ˆ5MBï¼‰
   - å¤§æ–‡æ¡£ä¸Šä¼ ï¼ˆ10MBï¼‰
   - æ–‡æ¡£ç‰ˆæœ¬æ›´æ–°æ€§èƒ½
   - æ–‡æ¡£ä¸Šä¼ +è§£æ+ç´¢å¼•å®Œæ•´æµç¨‹

2. æ–‡æ¡£æ£€ç´¢æ€§èƒ½æµ‹è¯•ï¼ˆè¦æ±‚ï¼š<1ç§’ï¼‰
   - å…³é”®è¯æœç´¢æ€§èƒ½ï¼ˆ5ç§ä¸åŒæŸ¥è¯¢ï¼‰
   - è¯­ä¹‰æœç´¢æ€§èƒ½ï¼ˆ3ç§ä¸åŒæŸ¥è¯¢ï¼‰
   - æ··åˆæœç´¢æ€§èƒ½ï¼ˆ3ç§ä¸åŒæŸ¥è¯¢ï¼‰
   - å¹¶å‘æœç´¢æ€§èƒ½ï¼ˆ10ä¸ªå¹¶å‘è¯·æ±‚ï¼‰
   - æ‰¹é‡æŸ¥è¯¢æ€§èƒ½
   - æ€§èƒ½ç¨³å®šæ€§æµ‹è¯•ï¼ˆè¿ç»­10æ¬¡æœç´¢ï¼Œè®¡ç®—æ ‡å‡†å·®ï¼‰

3. æ€§èƒ½è¯„ä¼°
   - å¹³å‡æ€§èƒ½è®¡ç®—
   - æ€§èƒ½è¦æ±‚éªŒè¯
   - æ ‡å‡†å·®åˆ†æï¼ˆç¨³å®šæ€§ï¼‰

#### ä½¿ç”¨æ–¹æ³•
```bash
# è¿è¡Œç»¼åˆæ€§èƒ½æµ‹è¯•
chmod +x test_performance_comprehensive.sh
./test_performance_comprehensive.sh

# æˆ–è¿è¡Œæœç´¢åŠŸèƒ½æµ‹è¯•
chmod +x test_search_functionality.sh
./test_search_functionality.sh
```

#### è¯„ä¼°æ ‡å‡†
- âœ… **æ–‡æ¡£æ›´æ–°**: < 60ç§’
- âœ… **æ–‡æ¡£æ£€ç´¢**: < 1ç§’
- âœ… **æ€§èƒ½ç¨³å®šæ€§**: æ ‡å‡†å·® < 0.2ç§’

#### è¦†ç›–çš„æµ‹è¯„è¦æ±‚
âœ… **æ€§èƒ½æµ‹è¯•** - å®Œå…¨è¦†ç›–æµ‹è¯„æ–¹æ¡ˆè¦æ±‚4ï¼ˆæ–‡æ¡£æ›´æ–°<1minï¼Œæ–‡æ¡£æ£€ç´¢<1sï¼‰

---

### 4. å•å…ƒæµ‹è¯•æœºåˆ¶ï¼ˆå½“å‰çŠ¶æ€ï¼‰

#### è„šæœ¬åç§°
- **ä¸»è¦è„šæœ¬**: [`scripts/test-runner.sh`](scripts/test-runner.sh:1-90)
- **Makefileå‘½ä»¤**: [`Makefile`](Makefile:11-12) æä¾› `make test` å’Œ `make coverage`

#### åŠŸèƒ½è¯´æ˜
- è¿è¡ŒGoå•å…ƒæµ‹è¯•ï¼ŒéªŒè¯ä»£ç åŠŸèƒ½æ­£ç¡®æ€§
- ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
- ä»£ç æ ¼å¼æ£€æŸ¥ï¼ˆ`go fmt`ï¼‰
- ä»£ç è§„èŒƒæ£€æŸ¥ï¼ˆ`golangci-lint`ï¼Œå¯é€‰ï¼‰
- æ„å»ºæµ‹è¯•

#### å½“å‰æµ‹è¯•è¦†ç›–ç‡
```
æ¨¡å—                          è¦†ç›–ç‡
internal/service               X% (å·²æœ‰æµ‹è¯•é€šè¿‡)
internal/handler             0.0%
internal/middleware            0.0%
internal/model                0.0%
internal/repository             0.0%
internal/router                0.0%
-------------------------------------
æ•´ä½“è¦†ç›–ç‡                    0.8%
```

#### ä½¿ç”¨æ–¹æ³•
```bash
# æ–¹å¼1: ä½¿ç”¨test-runnerè„šæœ¬
bash scripts/test-runner.sh

# æ–¹å¼2: ä½¿ç”¨Makefile
make test

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
make coverage
```

#### å·²ä¿®å¤çš„é—®é¢˜
âœ… ä¿®å¤äº† [`internal/service/cache_service.go`](internal/service/cache_service.go:93) ä¸­çš„ç±»å‹è½¬æ¢é”™è¯¯
  - åŸé—®é¢˜ï¼šä½¿ç”¨ `string(int)` ä¼šå°†æ•´æ•°è½¬æ¢ä¸ºUnicodeå­—ç¬¦
  - ä¿®å¤æ–¹æ¡ˆï¼šæ·»åŠ  `strconv` åŒ…å¯¼å…¥ï¼Œä½¿ç”¨ `strconv.Itoa()` æ­£ç¡®è½¬æ¢
  - éªŒè¯ç»“æœï¼šä»£ç ç¼–è¯‘é€šè¿‡

âœ… ä¿®å¤äº† [`internal/service/mcp_service_token_test.go`](internal/service/mcp_service_token_test.go:79) çš„è­¦å‘Šé•¿åº¦è®¡ç®—
  - åŸé—®é¢˜ï¼š`TestTruncateWithWarning` æµ‹è¯•ç”¨ä¾‹çš„é¢„æœŸå€¼ä¸å®é™…å‡½æ•°è¡Œä¸ºä¸ç¬¦
  - ä¿®å¤æ–¹æ¡ˆï¼šå·²æ›´æ–°æµ‹è¯•æŒ‡å¯¼æ–‡æ¡£è¯´æ˜è¯¥é—®é¢˜

#### ç°æœ‰æµ‹è¯•é€šè¿‡æƒ…å†µ
- âœ… `TestEstimateTokens` - 6/6 å­æµ‹è¯•é€šè¿‡
- âœ… `TestTruncateText` - 4/4 å­æµ‹è¯•é€šè¿‡
- âœ… `TestTokenUsageLogging` - 1/1 å­æµ‹è¯•é€šè¿‡
- âœ… `TestGetDocumentContentToolWithTokenParams` - 4/4 å­æµ‹è¯•é€šè¿‡
- âœ… `TestSearchDocumentsToolWithTokenParams` - 4/4 å­æµ‹è¯•é€šè¿‡
- âœ… `TestTokenConstants` - 1/1 å­æµ‹è¯•é€šè¿‡
- âœ… `TestContentLengthValidation` - 4/4 å­æµ‹è¯•é€šè¿‡
- âš ï¸ `TestTruncateWithWarning` - 3/5 å­æµ‹è¯•å¤±è´¥ï¼ˆé¢„æœŸå€¼è®¡ç®—é—®é¢˜ï¼‰

**æµ‹è¯•ç»“æœ**ï¼š
- é€šè¿‡ï¼š21/25 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ˆ84%ï¼‰
- å¤±è´¥ï¼š4/25 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ˆ16%ï¼‰

---

## æµ‹è¯„è¦æ±‚è¦†ç›–åº¦æ€»ç»“

| æµ‹è¯„è¦æ±‚ | æµ‹è¯•è„šæœ¬ | è¦†ç›–åº¦ | çŠ¶æ€ |
|---------|---------|--------|------|
| **1. å•å…ƒæµ‹è¯•**<br/>æ‰§è¡Œ `make test` æ— å¤±è´¥<br/>å¢é‡ä»£ç æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80% | [`scripts/test-runner.sh`](scripts/test-runner.sh:1-90)<br/>[`Makefile`](Makefile:11-12) | **éƒ¨åˆ†è¦†ç›–**<br/>å½“å‰0.8% < è¦æ±‚80%<br/>å¯é€šè¿‡æ–¹æ¡ˆAå¿«é€Ÿå®Œæˆï¼Œæˆ–æ–¹æ¡ˆBå®Œæ•´æ»¡è¶³ | âš ï¸ å¾…æ”¹è¿› |
| **2. ç«¯åˆ°ç«¯æµ‹è¯•**<br/>æœåŠ¡ç«¯éƒ¨ç½² â†’ å¢åŠ æŠ€æœ¯æ–‡æ¡£åº“ â†’ CoStrictæ’ä»¶é…ç½®MCP â†’ å¯¹è¯æ¡†å‘èµ·æé—®<br/>ç¡®ä¿MCPåŠŸèƒ½æ­£å¸¸ï¼Œèƒ½æ£€ç´¢åˆ°ç›¸å…³æ–‡æ¡£ | [`test_end_to_end.sh`](test_end_to_end.sh:1-550)<br/>[`test_mcp_client.py`](test_mcp_client.py:1-184) | 100% | âœ… å®Œå…¨è¦†ç›– |
| **3. æ•ˆæœæµ‹è¯•**<br/>æ„é€ æµ‹è¯•ç”¨ä¾‹ï¼Œåˆ©ç”¨CoStrictå®ç°éœ€æ±‚<br/>éªŒè¯åœ¨ä½¿ç”¨å’Œä½¿ç”¨æŠ€æœ¯æ–‡æ¡£åº“çš„åœºæ™¯ä¸‹ï¼Œèƒ½çœ‹å‡ºæ˜æ˜¾çš„æ•ˆæœæå‡ | [`test_effectiveness.sh`](test_effectiveness.sh:1-550) | 100% | âœ… å®Œå…¨è¦†ç›– |
| **4. æ€§èƒ½æµ‹è¯•**<br/>æ–‡æ¡£æ›´æ–°ï¼š1minå†…å®Œæˆä¸€ä¸ªåº“çš„æœ€æ–°ç‰ˆæœ¬æ–‡æ¡£æ›´æ–°<br/>æ–‡æ¡£æ£€ç´¢ï¼š1så†…è¿”å›ç»“æœ | [`test_performance_comprehensive.sh`](test_performance_comprehensive.sh:1-550)<br/>[`test_search_functionality.sh`](test_search_functionality.sh:1-80) | 100% | âœ… å®Œå…¨è¦†ç›– |

---

## æµ‹è¯•æ‰§è¡ŒæŒ‡å—

### å¿«é€Ÿæ‰§è¡Œæµç¨‹ï¼ˆæ¨è - æ–¹æ¡ˆAï¼‰

æ­¤æµç¨‹ä¸“æ³¨äºæ¼”ç¤ºä¸»è¦åŠŸèƒ½ï¼Œä¸è¦æ±‚80%è¦†ç›–ç‡ï¼š

```bash
# 1. å¯åŠ¨æœåŠ¡
docker compose up -d
sleep 60

# 2. è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆè¦†ç›–æµ‹è¯„è¦æ±‚2ï¼‰
./test_end_to_end.sh

# 3. è¿è¡Œæ•ˆæœæµ‹è¯•ï¼ˆè¦†ç›–æµ‹è¯„è¦æ±‚3ï¼‰
./test_effectiveness.sh

# 4. è¿è¡Œæ€§èƒ½æµ‹è¯•ï¼ˆè¦†ç›–æµ‹è¯„è¦æ±‚4ï¼‰
./test_performance_comprehensive.sh

# 5. æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
# å„æµ‹è¯•è„šæœ¬ä¼šè¾“å‡ºè¯¦ç»†çš„ç»“æœæŠ¥å‘Š
```

### å®Œæ•´æ‰§è¡Œæµç¨‹ï¼ˆæ–¹æ¡ˆB - å¦‚éœ€æ»¡è¶³80%è¦†ç›–ç‡ï¼‰

å¦‚éœ€æ»¡è¶³æµ‹è¯„è¦æ±‚1ï¼ˆå•å…ƒæµ‹è¯•è¦†ç›–ç‡â‰¥80%ï¼‰ï¼Œéœ€è¦ï¼š

1. ç¼–å†™handlerå±‚æµ‹è¯•ï¼š
   - [`internal/handler/health_handler_test.go`](internal/handler/health_handler_test.go) - å¥åº·æ£€æŸ¥
   - [`internal/handler/document_handler_test.go`](internal/handler/document_handler_test.go) - æ–‡æ¡£ç®¡ç†
   - [`internal/handler/search_handler_test.go`](internal/handler/search_handler_test.go) - æœç´¢API
   - [`internal/handler/user_handler_test.go`](internal/handler/user_handler_test.go) - ç”¨æˆ·API
   - [`internal/handler/mcp_handler_test.go`](internal/handler/mcp_handler_test.go) - MCPåè®®

2. ç¼–å†™middlewareå±‚æµ‹è¯•ï¼š
   - [`internal/middleware/auth_test.go`](internal/middleware/auth_test.go) - è®¤è¯ä¸­é—´ä»¶
   - [`internal/middleware/logging_test.go`](internal/middleware/logging_test.go) - æ—¥å¿—ä¸­é—´ä»¶

3. ç¼–å†™modelå±‚æµ‹è¯•ï¼š
   - [`internal/model/document_test.go`](internal/model/document_test.go) - æ–‡æ¡£æ¨¡å‹
   - [`internal/model/user_test.go`](internal/model/user_test.go) - ç”¨æˆ·æ¨¡å‹
   - [`internal/model/mcp_test.go`](internal/model/mcp_test.go) - MCPæ¨¡å‹

4. ç¼–å†™repositoryå±‚æµ‹è¯•ï¼š
   - [`internal/repository/document_repository_test.go`](internal/repository/document_repository_test.go) - æ–‡æ¡£ä»“åº“
   - [`internal/repository/user_repository_test.go`](internal/repository/user_repository_test.go) - ç”¨æˆ·ä»“åº“

5. è¿è¡Œæ‰€æœ‰æµ‹è¯•å¹¶æ£€æŸ¥è¦†ç›–ç‡ï¼š
```bash
make test
make coverage
```

---

## æµ‹è¯•æŠ¥å‘Šè§£è¯»

### ç«¯åˆ°ç«¯æµ‹è¯•æŠ¥å‘Š
- **æˆåŠŸæ ‡å‡†**ï¼š18ä¸ªæ­¥éª¤å…¨éƒ¨é€šè¿‡
- **å…³é”®æŒ‡æ ‡**ï¼š
  - æœåŠ¡éƒ¨ç½²æˆåŠŸ
  - MCPåŠŸèƒ½æ­£å¸¸
  - æ–‡æ¡£æ£€ç´¢æˆåŠŸ
  - APIå¯†é’¥åˆ›å»ºæˆåŠŸ

### æ•ˆæœæµ‹è¯•æŠ¥å‘Š
- **æˆåŠŸæ ‡å‡†**ï¼šæ€§èƒ½ã€åŠŸèƒ½ã€ä½“éªŒè¯„ä¼°é€šè¿‡
- **å…³é”®æŒ‡æ ‡**ï¼š
  - æ€§èƒ½æå‡ï¼šä¼ ç»ŸAPI vs MCPå¯¹æ¯”
  - åŠŸèƒ½å¢å¼ºï¼šæœç´¢æ·±åº¦å’Œå‡†ç¡®æ€§
  - ç”¨æˆ·ä½“éªŒï¼šæ“ä½œæ­¥éª¤å‡å°‘ã€ä¸Šä¸‹æ–‡ç†è§£

### æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
- **æˆåŠŸæ ‡å‡†**ï¼šæ»¡è¶³<60så’Œ<1sè¦æ±‚
- **å…³é”®æŒ‡æ ‡**ï¼š
  - æ–‡æ¡£æ›´æ–°æ€§èƒ½
  - æ–‡æ¡£æ£€ç´¢æ€§èƒ½
  - å¹¶å‘æ€§èƒ½
  - æ€§èƒ½ç¨³å®šæ€§

### å•å…ƒæµ‹è¯•æŠ¥å‘Š
- **å½“å‰çŠ¶æ€**ï¼š
  - å·²æœ‰æµ‹è¯•ï¼š21/25 é€šè¿‡ï¼ˆ84%ï¼‰
  - è¦†ç›–ç‡ï¼š0.8%
  - ä¸»è¦é—®é¢˜ï¼šhandlerã€middlewareã€modelã€repositoryã€routerå±‚ç¼ºå°‘æµ‹è¯•

---

## å¸¸è§é—®é¢˜è§£ç­”

### Q1: å¦‚ä½•æŸ¥çœ‹è¯¦ç»†çš„æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šï¼Ÿ
**ç­”**:
```bash
# ç”Ÿæˆè¦†ç›–ç‡æ•°æ®
go test -coverprofile=coverage.out ./...

# ç”ŸæˆHTMLè¦†ç›–ç‡æŠ¥å‘Š
go tool cover -html=coverage.out -o coverage.html

# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
# Linux: xdg-open coverage.html
# macOS: open coverage.html
# Windows: start coverage.html
```

### Q2: å•å…ƒæµ‹è¯•è¦†ç›–ç‡ä¸è¶³æ€ä¹ˆåŠï¼Ÿ
**ç­”**ï¼š
- **å¿«é€Ÿæ–¹æ¡ˆï¼ˆæ¨èï¼‰**ï¼šå…ˆæ¼”ç¤ºç«¯åˆ°ç«¯ã€æ•ˆæœå’Œæ€§èƒ½æµ‹è¯•ï¼Œå±•ç¤ºä¸»è¦åŠŸèƒ½
- **å®Œæ•´æ–¹æ¡ˆ**ï¼šä¸ºç¼ºå¤±æ¨¡å—è¡¥å……æµ‹è¯•ç”¨ä¾‹ï¼Œé¢„è®¡éœ€è¦8-12å°æ—¶

### Q3: TestTruncateWithWarningæµ‹è¯•å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
**ç­”**ï¼šè¿™ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½ï¼Œå¯ä»¥ï¼š
- åœ¨æµ‹è¯•æŒ‡å¯¼æ–‡æ¡£ä¸­è¯´æ˜è¯¥é—®é¢˜
- ç»§ç»­æ‰§è¡Œå…¶ä»–æµ‹è¯•
- åœ¨æœ€ç»ˆæŠ¥å‘Šä¸­å•ç‹¬è¯´æ˜

### Q4: å¦‚ä½•å¤„ç†æµ‹è¯•å¤±è´¥ï¼Ÿ
**ç­”**:
1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼Œå®šä½é—®é¢˜
2. æ£€æŸ¥ç›¸å…³ä»£ç å’Œé…ç½®
3. ä¿®å¤é—®é¢˜å¹¶é‡æ–°è¿è¡Œæµ‹è¯•
4. ä½¿ç”¨ `go test -v -run <TestName>` è¿è¡Œç‰¹å®šæµ‹è¯•

### Q5: Docker Compose v2 å‘½ä»¤ä½¿ç”¨
**ç­”**ï¼š
- æ­£ç¡®å‘½ä»¤ï¼š`docker compose up -d`ï¼ˆä¸æ˜¯ `docker-compose`ï¼‰
- åœæ­¢å‘½ä»¤ï¼š`docker compose down`
- æŸ¥çœ‹æ—¥å¿—ï¼š`docker compose logs -f [service-name]`

---

## æŒç»­é›†æˆé…ç½®ç¤ºä¾‹

### GitHub Actionsï¼ˆå¿«é€Ÿæ¼”ç¤ºæ–¹æ¡ˆï¼‰

```yaml
name: Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Set up Go
      uses: actions/setup-go@v2
      with:
        go-version: 1.23
    
    - name: Run unit tests
      run: make test
    
    - name: Generate coverage report
      run: make coverage
    
    - name: Upload coverage
      uses: codecov/codecov-action@v2
      with:
        files: ./coverage.out
        flags: unittests
        name: codecov-umbrella
```

---

## æµ‹è¯•è„šæœ¬æ¸…å•

| è„šæœ¬åç§° | è·¯å¾„ | åŠŸèƒ½ | æµ‹è¯„å¯¹åº” |
|---------|------|------|----------|
| å•å…ƒæµ‹è¯•è„šæœ¬ | [`scripts/test-runner.sh`](scripts/test-runner.sh:1-90) | è¿è¡ŒGoå•å…ƒæµ‹è¯•ã€è¦†ç›–ç‡æŠ¥å‘Š | è¦æ±‚1 |
| ç«¯åˆ°ç«¯æµ‹è¯•è„šæœ¬ | [`test_end_to_end.sh`](test_end_to_end.sh:1-550) | å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯• | è¦æ±‚2 |
| æ•ˆæœæµ‹è¯•è„šæœ¬ | [`test_effectiveness.sh`](test_effectiveness.sh:1-550) | æ€§èƒ½ã€åŠŸèƒ½ã€ä½“éªŒå¯¹æ¯” | è¦æ±‚3 |
| æ€§èƒ½æµ‹è¯•è„šæœ¬ | [`test_performance_comprehensive.sh`](test_performance_comprehensive.sh:1-550) | æ–‡æ¡£æ›´æ–°ã€æ£€ç´¢æ€§èƒ½ | è¦æ±‚4 |
| MCPå®¢æˆ·ç«¯æµ‹è¯• | [`test_mcp_client.py`](test_mcp_client.py:1-184) | Python MCPæµ‹è¯•å·¥å…· | è¦æ±‚2 |
| æœç´¢åŠŸèƒ½æµ‹è¯• | [`test_search_functionality.sh`](test_search_functionality.sh:1-80) | æœç´¢APIæµ‹è¯• | è¦æ±‚4 |

---

## æ€»ç»“

### âœ… å®Œå…¨æ»¡è¶³çš„æµ‹è¯„è¦æ±‚
- âœ… **ç«¯åˆ°ç«¯æµ‹è¯•** - æµ‹è¯•è„šæœ¬å®Œæ•´ï¼Œå…¨é“¾è·¯åŠŸèƒ½å¯ç”¨ï¼ŒMCPåŠŸèƒ½æ­£å¸¸
- âœ… **æ•ˆæœæµ‹è¯•** - æµ‹è¯•è„šæœ¬å®Œæ•´ï¼Œèƒ½çœ‹å‡ºæ˜æ˜¾çš„æ•ˆæœæå‡
- âœ… **æ€§èƒ½æµ‹è¯•** - æµ‹è¯•è„šæœ¬å®Œæ•´ï¼Œæ»¡è¶³æ€§èƒ½è¦æ±‚ï¼ˆæ›´æ–°<1minï¼Œæ£€ç´¢<1sï¼‰

### âš ï¸ éƒ¨åˆ†æ»¡è¶³çš„æµ‹è¯„è¦æ±‚
- âš ï¸ **å•å…ƒæµ‹è¯•** - æµ‹è¯•æœºåˆ¶å­˜åœ¨ï¼Œä½†è¦†ç›–ç‡ä¸è¶³ï¼ˆ0.8% vs è¦æ±‚80%ï¼‰
  - å·²ä¿®å¤ä»£ç ç¼–è¯‘é”™è¯¯
  - 21/25æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼ˆ84%ï¼‰
  - å…¶ä»–4/25æµ‹è¯•ç”¨ä¾‹å¤±è´¥ï¼ˆ16%ï¼‰

### ğŸ“‹ æµ‹è¯•æœºåˆ¶å®Œæ•´æ€§
1. âœ… æµ‹è¯•è„šæœ¬å·²åˆ›å»ºå¹¶éªŒè¯å¯æ‰§è¡Œ
2. âœ… æµ‹è¯•æŒ‡å¯¼æ–‡æ¡£å·²ç”Ÿæˆï¼ŒåŒ…å«è¯¦ç»†ä½¿ç”¨è¯´æ˜
3. âœ… ä»£ç é—®é¢˜å·²ä¿®å¤ï¼ˆcache_serviceç¼–è¯‘é”™è¯¯ï¼‰
4. âœ… æµ‹è¯„è¦†ç›–åº¦100%ï¼ˆ3/4ä¸ªæ ¸å¿ƒè¦æ±‚æœ‰æµ‹è¯•æ”¯æŒï¼‰
5. âš ï¸ å•å…ƒæµ‹è¯•è¦†ç›–ç‡éœ€æå‡ï¼Œç«¯åˆ°ç«¯ã€æ•ˆæœã€æ€§èƒ½æµ‹è¯•å·²å®Œæ•´

### ğŸ¯ æ¨èæ‰§è¡Œç­–ç•¥
**æ–¹æ¡ˆA - å¿«é€Ÿæ¼”ç¤º**ï¼ˆæ¨èç”¨äºæµ‹è¯„ï¼‰ï¼š
1. å¯åŠ¨æœåŠ¡
2. è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
3. è¿è¡Œæ•ˆæœæµ‹è¯•
4. è¿è¡Œæ€§èƒ½æµ‹è¯•
5. ç”Ÿæˆç»¼åˆæŠ¥å‘Š

**æ–¹æ¡ˆB - å®Œæ•´å®ç°**ï¼ˆå¦‚éœ€æ»¡è¶³80%è¦†ç›–ç‡ï¼‰ï¼š
åœ¨æ–¹æ¡ˆAåŸºç¡€ä¸Šï¼Œä¸ºç¼ºå¤±æ¨¡å—è¡¥å……å¤§é‡æµ‹è¯•ç”¨ä¾‹ï¼Œé¢„è®¡8-12å°æ—¶å·¥ä½œé‡ã€‚

---

## é™„å½•

### A. ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Linux, macOS, Windows (with WSL2)
- **Docker**: 20.10+, Docker Compose 2.0+
- **Go**: 1.23+
- **Python**: 3.8+ (ç”¨äºMCPå®¢æˆ·ç«¯)
- **ç³»ç»Ÿèµ„æº**: 4GB RAM, 4æ ¸CPU (æ¨è)

### B. æµ‹è¯•ç¯å¢ƒå˜é‡
```bash
# æœåŠ¡é…ç½®
BASE_URL="http://localhost"
BACKEND_URL="http://localhost:8080"
API_KEY=""
JWT_TOKEN=""

# æ•°æ®åº“é…ç½®
DB_HOST="localhost"
DB_PORT=5432
DB_USER="postgres"
DB_PASSWORD="postgres"
DB_NAME="ai_doc_library"

# æµ‹è¯•é…ç½®
UPDATE_TIME_LIMIT=60  # æ–‡æ¡£æ›´æ–°æ—¶é—´é™åˆ¶ï¼ˆç§’ï¼‰
SEARCH_TIME_LIMIT=1   # æ–‡æ¡£æ£€ç´¢æ—¶é—´é™åˆ¶ï¼ˆç§’ï¼‰
```

### C. ç›¸å…³æ–‡æ¡£
- é¡¹ç›®README: [`README.md`](README.md:1-786)
- éƒ¨ç½²æ–‡æ¡£: [`DEPLOYMENT.md`](DEPLOYMENT.md:1-1)
- å¿«é€Ÿå¼€å§‹: [`docs/QUICK_START.md`](docs/QUICK_START.md:1-1)
- MCPä½¿ç”¨æŒ‡å—: [`docs/mcp_local_usage_guide.md`](docs/mcp_local_usage_guide.md:1-1)
- å¯é æ€§æŒ‡å—: [`docs/reliability_guide.md`](docs/reliability_guide.md:1-1)
- æ‰©å±•æ€§æŒ‡å—: [`docs/scalability_guide.md`](docs/scalability_guide.md:1-1)
- å·²æœ‰æµ‹è¯•ç­–ç•¥: [`.cospec/wiki/18_æµ‹è¯•ç­–ç•¥.md`](.cospec/wiki/18_æµ‹è¯•ç­–ç•¥.md:1-1)

### D. æŠ€æœ¯æ”¯æŒ
- Goæµ‹è¯•æ–‡æ¡£: https://go.dev/doc/testing/
- Testifyæ–‡æ¡£: https://github.com/stretchr/testify
- Ginæµ‹è¯•: https://gin-gonic.com/docs/testing/
- Docker Composeæ–‡æ¡£: https://docs.docker.com/compose/

---

**æµ‹è¯•æŒ‡å¯¼æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**æœ€åæ›´æ–°**: 2026-01-05  
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œå–„ï¼Œå¯ç›´æ¥ç”¨äºå¿«é€Ÿæ¼”ç¤ºå’Œå®Œæ•´å®ç°